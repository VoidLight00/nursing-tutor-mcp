# 10-RAGμ‹μ¤ν…κµ¬μ¶•

## π― κ°μ”
κ°„νΈν•™ μ „λ¬Έ μ§€μ‹μ„ κΈ°λ°μΌλ΅ ν• RAG(Retrieval-Augmented Generation) μ‹μ¤ν…μ„ κµ¬μ¶•ν•μ—¬, μ •ν™•ν•κ³  μµμ‹ μ κ°„νΈν•™ μ •λ³΄λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ κ³µν•λ” μ§€λ¥ν• ν•™μµ μ§€μ› μ‹μ¤ν…μ…λ‹λ‹¤.

## π§  RAG μ‹μ¤ν… μ•„ν‚¤ν…μ²

### 1. λ°μ΄ν„° μμ§‘ λ μ΄μ–΄
- **κ°„νΈν•™ κµμ¬ λ° λ…Όλ¬Έ**: μµμ‹  κ°„νΈν•™ κµμ¬, μ—°κµ¬ λ…Όλ¬Έ, κ°€μ΄λ“λΌμΈ
- **μ„μƒ κ°€μ΄λ“λΌμΈ**: WHO, CDC, κ°κµ­ λ³΄κ±΄λ¶€ κ°€μ΄λ“λΌμΈ
- **μ „λ¬Έ λ°μ΄ν„°λ² μ΄μ¤**: PubMed, CINAHL, Cochrane Library
- **λ²•λ Ή λ° κ·μ •**: μλ£λ²•, κ°„νΈμ‚¬λ²•, μ„μƒμ‹ν— κ·μ •

### 2. μ„λ² λ”© λ° λ²΅ν„°ν™”
- **ν…μ¤νΈ μ „μ²λ¦¬**: μν•™ μ©μ–΄ μ •κ·ν™”, λ‹¤κµ­μ–΄ μ²λ¦¬
- **μ²­ν‚Ή μ „λµ**: μλ―Έ λ‹¨μ„λ³„ λ¶„ν• , μ»¨ν…μ¤νΈ λ³΄μ΅΄
- **μ„λ² λ”© λ¨λΈ**: μν•™ μ „λ¬Έ μ„λ² λ”© λ¨λΈ ν™μ©
- **λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤**: ChromaDB, Pinecone λ“± ν™μ©

### 3. κ²€μƒ‰ λ° μƒμ„± λ μ΄μ–΄
- **ν•μ΄λΈλ¦¬λ“ κ²€μƒ‰**: ν‚¤μ›λ“ + μλ―Έ κΈ°λ° κ²€μƒ‰
- **μ¬λ­ν‚Ή μ‹μ¤ν…**: κ΄€λ ¨μ„± λ° μ‹ λΆ°λ„ κΈ°λ° μμ„ μ΅°μ •
- **μ»¨ν…μ¤νΈ μµμ ν™”**: μ§λ¬Έμ— μµμ ν™”λ μ»¨ν…μ¤νΈ κµ¬μ„±
- **μ‘λ‹µ μƒμ„±**: μ „λ¬Έμ„±κ³Ό μ •ν™•μ„±μ„ λ³΄μ¥ν•λ” μƒμ„±

## π“ μ „λ¬Έ μ§€μ‹ λ² μ΄μ¤ κµ¬μ„±

### 1. κ°„νΈν•™ ν•µμ‹¬ μμ—­
```
κ°„νΈν•™ μ§€μ‹ λ² μ΄μ¤/
β”β”€β”€ κΈ°λ³Έκ°„νΈν•™/
β”‚   β”β”€β”€ κ°„νΈκ³Όμ •/
β”‚   β”β”€β”€ κΈ°λ³Έκ°„νΈμ /
β”‚   β””β”€β”€ ν™μμ•μ „/
β”β”€β”€ μ„±μΈκ°„νΈν•™/
β”‚   β”β”€β”€ λ‚΄κ³Όκ°„νΈ/
β”‚   β”β”€β”€ μ™Έκ³Όκ°„νΈ/
β”‚   β””β”€β”€ μ¤‘ν™μκ°„νΈ/
β”β”€β”€ μΆ…μ–‘κ°„νΈν•™/
β”‚   β”β”€β”€ ν™”ν•™μ”λ²•/
β”‚   β”β”€β”€ λ°©μ‚¬μ„ μΉλ£/
β”‚   β”β”€β”€ λ©΄μ—­μΉλ£/
β”‚   β””β”€β”€ μ™„ν™”κ°„νΈ/
β”β”€β”€ μ μ „μμΉλ£κ°„νΈ/
β”‚   β”β”€β”€ λ¶„μμƒλ¬Όν•™κΈ°μ΄/
β”‚   β”β”€β”€ μ μ „μƒλ‹΄/
β”‚   β”β”€β”€ μ μ „μνΈμ§‘/
β”‚   β””β”€β”€ μ¤λ¦¬μ κ³ λ ¤μ‚¬ν•­/
β””β”€β”€ μ„μƒμ‹ν—κ°„νΈ/
    β”β”€β”€ GCPκ·μ •/
    β”β”€β”€ ν”„λ΅ν† μ½κ΄€λ¦¬/
    β”β”€β”€ λ°μ΄ν„°μμ§‘/
    β””β”€β”€ μ•μ „μ„±λ¨λ‹ν„°λ§/
```

### 2. λ°μ΄ν„° ν’μ§ κ΄€λ¦¬
- **μ‹ λΆ°μ„± κ²€μ¦**: μ „λ¬Έκ°€ κ²€ν† , λ™λ£ ν‰κ°€
- **μµμ‹ μ„± μ μ§€**: μ •κΈ° μ—…λ°μ΄νΈ, μλ™ κ°±μ‹ 
- **μ •ν™•μ„± λ³΄μ¥**: ν©νΈ μ²΄ν‚Ή, μ¤λ¥ νƒμ§€
- **μΌκ΄€μ„± κ΄€λ¦¬**: μ©μ–΄ ν†µμΌ, λ²μ—­ ν’μ§

## π” κ²€μƒ‰ μµμ ν™”

### 1. μ§μ μ΄ν•΄ λ° ν™•μ¥
```python
class QueryProcessor:
    def __init__(self):
        self.medical_ner = MedicalNER()
        self.query_expander = QueryExpander()
        self.synonym_mapper = SynonymMapper()
    
    def process_query(self, query: str) -> ProcessedQuery:
        # μν•™ μ©μ–΄ μΈμ‹
        entities = self.medical_ner.extract(query)
        
        # μ§μ ν™•μ¥
        expanded_query = self.query_expander.expand(query, entities)
        
        # λ™μμ–΄ λ§¤ν•‘
        mapped_query = self.synonym_mapper.map(expanded_query)
        
        return ProcessedQuery(
            original=query,
            expanded=expanded_query,
            mapped=mapped_query,
            entities=entities
        )
```

### 2. λ©€ν‹°λ¨λ‹¬ κ²€μƒ‰
- **ν…μ¤νΈ κ²€μƒ‰**: κ°λ…, μ •μ, μ„¤λ… κ²€μƒ‰
- **μ΄λ―Έμ§€ κ²€μƒ‰**: ν•΄λ¶€ν•™ μ΄λ―Έμ§€, μ°¨νΈ, λ‹¤μ΄μ–΄κ·Έλ¨
- **λΉ„λ””μ¤ κ²€μƒ‰**: κ°„νΈ μ κΈ°, μ‹λ®¬λ μ΄μ… μμƒ
- **μμ„± κ²€μƒ‰**: κ°•μ λ‚΄μ©, ν™μ κµμ΅ μλ£

### 3. κ°μΈν™” κ²€μƒ‰
- **ν•™μµ μ΄λ ¥ λ°μ**: μ΄μ „ ν•™μµ λ‚΄μ© κ³ λ ¤
- **λ‚μ΄λ„ μ΅°μ **: ν•™μµμ μμ¤€μ— λ§λ” λ‚΄μ©
- **κ΄€μ‹¬ λ¶„μ•Ό μ°μ„ **: μ „λ¬Έ λ¶„μ•Ό κ°€μ¤‘μΉ μ μ©
- **ν•™μµ μ¤νƒ€μΌ λ°μ**: μ„ νΈν•λ” ν•™μµ λ°©μ‹ κ³ λ ¤

## π¤– μƒμ„± λ¨λΈ μµμ ν™”

### 1. ν”„λ΅¬ν”„νΈ μ—”μ§€λ‹μ–΄λ§
```python
NURSING_PROMPT_TEMPLATE = """
λ‹Ήμ‹ μ€ κ°„νΈν•™ μ „λ¬Έκ°€μ…λ‹λ‹¤. λ‹¤μ μ»¨ν…μ¤νΈλ¥Ό λ°”νƒ•μΌλ΅ μ§λ¬Έμ— λ‹µλ³€ν•΄μ£Όμ„Έμ”.

μ»¨ν…μ¤νΈ:
{context}

μ§λ¬Έ: {question}

λ‹µλ³€ μ‹ λ‹¤μ μ‚¬ν•­μ„ κ³ λ ¤ν•΄μ£Όμ„Έμ”:
1. κ·Όκ±° κΈ°λ° μ‹¤λ¬΄ μ›μΉ™ μ μ©
2. ν™μ μ•μ „μ„ μµμ°μ„  κ³ λ ¤
3. μ¤λ¦¬μ  μΈ΅λ©΄ κ³ λ ¤
4. μµμ‹  κ°€μ΄λ“λΌμΈ λ°μ
5. μ‹¤λ¬΄ μ μ© κ°€λ¥μ„± μ μ‹

λ‹µλ³€:
"""
```

### 2. λ„λ©”μΈ νΉν™” Fine-tuning
- **κ°„νΈν•™ μ©μ–΄ ν•™μµ**: μ „λ¬Έ μ©μ–΄ μ΄ν•΄λ„ ν–¥μƒ
- **μ„μƒ μ¶”λ΅  λ¥λ ¥**: μ‚¬λ΅€ κΈ°λ° μ¶”λ΅  ν•™μµ
- **μ¤λ¦¬μ  νλ‹¨**: κ°„νΈ μ¤λ¦¬ μ›μΉ™ ν•™μµ
- **λ‹¤κµ­μ–΄ μ§€μ›**: ν•κµ­μ–΄, μμ–΄ λ™μ‹ μ§€μ›

### 3. μ‘λ‹µ ν’μ§ κ΄€λ¦¬
- **ν©νΈ μ²΄ν‚Ή**: μν•™μ  μ‚¬μ‹¤ κ²€μ¦
- **μΌκ΄€μ„± κ²€μ‚¬**: μ΄μ „ λ‹µλ³€κ³Όμ μΌκ΄€μ„±
- **μ•μ „μ„± ν•„ν„°**: μ„ν—ν• μ •λ³΄ μ°¨λ‹¨
- **ν”Όλ“λ°± ν•™μµ**: μ‚¬μ©μ ν”Όλ“λ°± λ°μ

## π“ μ„±λ¥ λ¨λ‹ν„°λ§

### 1. κ²€μƒ‰ μ„±λ¥ μ§€ν‘
- **μ •ν™•λ„ (Precision)**: κ΄€λ ¨ λ¬Έμ„ λΉ„μ¨
- **μ¬ν„μ¨ (Recall)**: μ°Ύμ•„λ‚Έ κ΄€λ ¨ λ¬Έμ„ λΉ„μ¨
- **F1 μ μ**: μ •ν™•λ„μ™€ μ¬ν„μ¨μ μ΅°ν™” ν‰κ· 
- **MRR (Mean Reciprocal Rank)**: μ²« λ²μ§Έ κ΄€λ ¨ κ²°κ³Ό μμ„

### 2. μƒμ„± ν’μ§ μ§€ν‘
- **BLEU μ μ**: μ°Έμ΅° λ‹µλ³€κ³Όμ μ μ‚¬λ„
- **ROUGE μ μ**: μ”μ•½ ν’μ§ μΈ΅μ •
- **μ „λ¬Έκ°€ ν‰κ°€**: κ°„νΈν•™ μ „λ¬Έκ°€ κ²€ν† 
- **μ‚¬μ©μ λ§μ΅±λ„**: μ‹¤μ  μ‚¬μ©μ ν”Όλ“λ°±

### 3. μ‹μ¤ν… μ„±λ¥ μ§€ν‘
- **μ‘λ‹µ μ‹κ°„**: μ§μ μ²λ¦¬ μ†λ„
- **μ²λ¦¬λ‰**: λ™μ‹ μ²λ¦¬ κ°€λ¥ μ”μ²­ μ
- **κ°€μ©μ„±**: μ‹μ¤ν… μ΄μ μ‹κ°„
- **ν™•μ¥μ„±**: λ°μ΄ν„° μ¦κ°€ λ€μ‘ λ¥λ ¥

## π”§ κΈ°μ  μ¤νƒ

### 1. λ°±μ—”λ“ μΈν”„λΌ
```yaml
# Docker Compose μ„¤μ •
version: '3.8'
services:
  vector-db:
    image: chromadb/chroma:latest
    ports:
      - "8000:8000"
    volumes:
      - ./data:/chroma/data
  
  embedding-service:
    image: sentence-transformers/all-MiniLM-L6-v2
    ports:
      - "8001:8001"
  
  rag-api:
    build: ./rag-service
    ports:
      - "8002:8002"
    depends_on:
      - vector-db
      - embedding-service
```

### 2. λ°μ΄ν„° νμ΄ν”„λΌμΈ
```python
class DataPipeline:
    def __init__(self):
        self.extractor = DocumentExtractor()
        self.processor = TextProcessor()
        self.embedder = EmbeddingModel()
        self.vectordb = VectorDatabase()
    
    def process_document(self, doc_path: str):
        # λ¬Έμ„ μ¶”μ¶
        text = self.extractor.extract(doc_path)
        
        # ν…μ¤νΈ μ „μ²λ¦¬
        chunks = self.processor.chunk(text)
        
        # μ„λ² λ”© μƒμ„±
        embeddings = self.embedder.embed(chunks)
        
        # λ²΅ν„° DB μ €μ¥
        self.vectordb.store(chunks, embeddings)
```

### 3. API μΈν„°νμ΄μ¤
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class QueryRequest(BaseModel):
    question: str
    user_id: str
    context_length: int = 3

class QueryResponse(BaseModel):
    answer: str
    sources: List[str]
    confidence: float
    processing_time: float

@app.post("/query", response_model=QueryResponse)
async def query_rag(request: QueryRequest):
    # RAG μ²λ¦¬ λ΅μ§
    result = await rag_engine.process_query(
        question=request.question,
        user_id=request.user_id,
        context_length=request.context_length
    )
    
    return QueryResponse(**result)
```

## π λ°°ν¬ λ° ν™•μ¥

### 1. ν΄λΌμ°λ“ λ°°ν¬
- **μ»¨ν…μ΄λ„ν™”**: Docker κΈ°λ° λ°°ν¬
- **μ¤μΌ€μ¤νΈλ μ΄μ…**: Kubernetes ν΄λ¬μ¤ν„°
- **λ΅λ“ λ°Έλ°μ‹±**: νΈλν”½ λ¶„μ‚° μ²λ¦¬
- **μλ™ μ¤μΌ€μΌλ§**: λ¶€ν•μ— λ”°λ¥Έ μλ™ ν™•μ¥

### 2. μ—£μ§€ μ»΄ν“¨ν…
- **λ΅μ»¬ λ¨λΈ**: ν”„λΌμ΄λ²„μ‹ λ³΄νΈ
- **μ¤ν”„λΌμΈ λ¨λ“**: μΈν„°λ„· μ—°κ²° λ¶ν•„μ”
- **λΉ λ¥Έ μ‘λ‹µ**: μ§€μ—° μ‹κ°„ μµμ†ν™”
- **λ°μ΄ν„° λ³΄μ•**: λ΅μ»¬ λ°μ΄ν„° μ²λ¦¬

### 3. λ¨λ°”μΌ μµμ ν™”
- **κ²½λ‰ν™” λ¨λΈ**: λ¨λ°”μΌ κΈ°κΈ° μµμ ν™”
- **μ••μ¶• κΈ°μ **: λ¨λΈ ν¬κΈ° μµμ†ν™”
- **λ°°ν„°λ¦¬ ν¨μ¨**: μ „λ ¥ μ†λΉ„ μµμ ν™”
- **μ¤ν”„λΌμΈ λ™κΈ°ν™”**: μλ™ μ—…λ°μ΄νΈ

---

**λ©ν‘**: μ •ν™•ν•κ³  μ‹ λΆ°ν•  μ μλ” κ°„νΈν•™ μ „λ¬Έ μ§€μ‹ μ κ³µ
**νΉμ§•**: μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ, κ°μΈ λ§μ¶¤ν• κ²€μƒ‰, λ‹¤λ¨λ‹¬ μ§€μ›
**κ²°κ³Ό**: ν•™μµ ν¨μ¨μ„± κ·Ήλ€ν™” λ° μ„μƒ μμ‚¬κ²°μ • μ§€μ›